<!-- Interface de Relatórios para integrar no módulo terapeuta -->
<!-- Este conteúdo deve ser inserido na seção de relatórios do terapeuta.html -->

<div id="reports-view" class="view-content" style="display: none;">
    <div class="reports-header">
        <h2>📊 Relatórios de Evolução</h2>
        <p>Análise detalhada do progresso dos pacientes com gráficos e exportação PDF</p>
    </div>

    <!-- Filtros de Relatórios -->
    <div class="reports-filters">
        <div class="filter-group">
            <label for="report-patient-select">👤 Paciente:</label>
            <select id="report-patient-select" class="filter-input">
                <option value="">Todos os pacientes</option>
            </select>
        </div>
        
        <div class="filter-group">
            <label for="report-date-from">📅 Data Inicial:</label>
            <input type="date" id="report-date-from" class="filter-input">
        </div>
        
        <div class="filter-group">
            <label for="report-date-to">📅 Data Final:</label>
            <input type="date" id="report-date-to" class="filter-input">
        </div>
        
        <div class="filter-actions">
            <button id="clear-filters" class="btn-secondary">🗑️ Limpar Filtros</button>
            <button id="apply-filters" class="btn-primary">🔍 Aplicar Filtros</button>
        </div>
    </div>

    <!-- Abas de Relatórios -->
    <div class="reports-tabs">
        <button class="tab-btn active" data-tab="general">📈 Geral</button>
        <button class="tab-btn" data-tab="groups">📊 Por Grupos</button>
        <button class="tab-btn" data-tab="subgroups">🎯 Por Subgrupos</button>
        <button class="tab-btn" data-tab="evolution">📈 Evolução</button>
    </div>

    <!-- Conteúdo das Abas -->
    <div class="reports-content">
        
        <!-- Relatório Geral -->
        <div id="general-tab" class="report-tab active">
            <div class="report-header">
                <h3>📊 Relatório Geral</h3>
                <button class="export-btn" data-export-pdf="geral">📄 Exportar PDF</button>
            </div>
            <div class="report-body">
                <div class="chart-container">
                    <canvas id="general-chart" width="800" height="400"></canvas>
                </div>
                <div id="general-stats" class="stats-container"></div>
            </div>
        </div>

        <!-- Relatório por Grupos -->
        <div id="groups-tab" class="report-tab">
            <div class="report-header">
                <h3>📊 Relatório por Grupos de Habilidades</h3>
                <button class="export-btn" data-export-pdf="por_grupo">📄 Exportar PDF</button>
            </div>
            <div class="report-body">
                <div class="chart-container">
                    <canvas id="groups-chart" width="800" height="400"></canvas>
                </div>
                <div id="groups-stats" class="stats-container"></div>
            </div>
        </div>

        <!-- Relatório por Subgrupos -->
        <div id="subgroups-tab" class="report-tab">
            <div class="report-header">
                <h3>🎯 Relatório por Subgrupos</h3>
                <button class="export-btn" data-export-pdf="por_subgrupo">📄 Exportar PDF</button>
            </div>
            <div class="report-body">
                <div class="chart-container">
                    <canvas id="subgroups-chart" width="800" height="400"></canvas>
                </div>
                <div id="subgroups-stats" class="stats-container"></div>
            </div>
        </div>

        <!-- Relatório de Evolução -->
        <div id="evolution-tab" class="report-tab">
            <div class="report-header">
                <h3>📈 Evolução Temporal</h3>
                <button class="export-btn" data-export-pdf="evolucao">📄 Exportar PDF</button>
            </div>
            <div class="report-body">
                <div class="evolution-notice">
                    <p>💡 <strong>Dica:</strong> Selecione um paciente específico para visualizar sua evolução ao longo do tempo.</p>
                </div>
                <div class="chart-container">
                    <canvas id="evolution-chart" width="800" height="400"></canvas>
                </div>
                <div id="evolution-stats" class="stats-container"></div>
            </div>
        </div>
    </div>

    <!-- Ações Globais -->
    <div class="global-actions">
        <button id="export-complete-report" class="btn-primary large" data-export-pdf="complete">
            📋 Exportar Relatório Completo (PDF)
        </button>
        <button id="refresh-reports" class="btn-secondary">🔄 Atualizar Relatórios</button>
    </div>
</div>

<!-- Estilos CSS para os Relatórios -->
<style>
    .reports-header {
        text-align: center;
        margin-bottom: 30px;
        padding: 20px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border-radius: 10px;
    }

    .reports-filters {
        display: flex;
        flex-wrap: wrap;
        gap: 15px;
        align-items: center;
        background: #f8f9fa;
        padding: 20px;
        border-radius: 8px;
        margin-bottom: 25px;
    }

    .filter-group {
        display: flex;
        flex-direction: column;
        gap: 5px;
        min-width: 150px;
    }

    .filter-group label {
        font-weight: bold;
        color: #555;
        font-size: 14px;
    }

    .filter-input {
        padding: 8px 12px;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-size: 14px;
    }

    .filter-input:focus {
        outline: none;
        border-color: #667eea;
        box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.2);
    }

    .filter-actions {
        display: flex;
        gap: 10px;
        align-items: flex-end;
    }

    .reports-tabs {
        display: flex;
        gap: 0;
        background: #e9ecef;
        border-radius: 8px;
        padding: 4px;
        margin-bottom: 25px;
    }

    .tab-btn {
        flex: 1;
        padding: 12px 16px;
        border: none;
        background: transparent;
        cursor: pointer;
        border-radius: 6px;
        font-weight: 500;
        transition: all 0.3s ease;
    }

    .tab-btn:hover {
        background: rgba(102, 126, 234, 0.1);
    }

    .tab-btn.active {
        background: #667eea;
        color: white;
        box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
    }

    .reports-content {
        background: white;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        overflow: hidden;
    }

    .report-tab {
        display: none;
        padding: 25px;
    }

    .report-tab.active {
        display: block;
    }

    .report-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        padding-bottom: 15px;
        border-bottom: 2px solid #f0f0f0;
    }

    .report-header h3 {
        margin: 0;
        color: #333;
        font-size: 20px;
    }

    .export-btn {
        background: #28a745;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 5px;
        cursor: pointer;
        font-weight: 500;
        transition: background 0.3s ease;
    }

    .export-btn:hover {
        background: #218838;
        transform: translateY(-1px);
    }

    .report-body {
        display: flex;
        flex-direction: column;
        gap: 25px;
    }

    .chart-container {
        position: relative;
        background: #fafafa;
        border-radius: 8px;
        padding: 20px;
        height: 400px;
    }

    .chart-container canvas {
        max-width: 100%;
        max-height: 100%;
    }

    .stats-container {
        background: #f8f9fa;
        border-radius: 8px;
        padding: 20px;
    }

    .stats-summary {
        margin-bottom: 20px;
    }

    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
        gap: 15px;
        margin: 15px 0;
    }

    .stat-item {
        text-align: center;
        background: white;
        padding: 15px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .stat-number {
        display: block;
        font-size: 24px;
        font-weight: bold;
        color: #667eea;
    }

    .stat-label {
        display: block;
        font-size: 12px;
        color: #666;
        margin-top: 5px;
    }

    .detailed-stats {
        margin-top: 20px;
    }

    .category-stat {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin: 10px 0;
    }

    .category-name {
        font-weight: 500;
        min-width: 200px;
        color: #333;
    }

    .score-bar {
        flex: 1;
        height: 24px;
        background: #e9ecef;
        border-radius: 12px;
        position: relative;
        margin: 0 15px;
        overflow: hidden;
    }

    .score-fill {
        height: 100%;
        border-radius: 12px;
        transition: width 0.8s ease;
        position: relative;
    }

    .score-text {
        position: absolute;
        right: 10px;
        top: 50%;
        transform: translateY(-50%);
        font-weight: bold;
        color: white;
        text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
        font-size: 14px;
    }

    .stats-table h4 {
        margin: 0 0 15px 0;
        color: #333;
    }

    .group-stats {
        background: white;
        padding: 15px;
        border-radius: 8px;
        margin: 10px 0;
        border-left: 4px solid #667eea;
    }

    .group-stats h5 {
        margin: 0 0 10px 0;
        font-size: 16px;
    }

    .mini-stats {
        display: flex;
        gap: 20px;
        font-size: 14px;
        color: #666;
    }

    .ranking-item {
        display: flex;
        align-items: center;
        gap: 15px;
        padding: 12px;
        background: white;
        border-radius: 8px;
        margin: 8px 0;
        box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }

    .ranking-position {
        font-size: 18px;
        font-weight: bold;
        min-width: 40px;
        text-align: center;
    }

    .ranking-name {
        flex: 1;
        font-weight: 500;
    }

    .ranking-score {
        font-weight: bold;
        font-size: 16px;
        min-width: 60px;
        text-align: right;
    }

    .ranking-count {
        font-size: 12px;
        color: #666;
        min-width: 80px;
        text-align: right;
    }

    .evolution-table {
        background: white;
        border-radius: 8px;
        overflow: hidden;
    }

    .evolution-summary {
        background: #f8f9fa;
        padding: 15px;
        border-bottom: 1px solid #dee2e6;
    }

    .evolution-summary p {
        margin: 5px 0;
        color: #555;
    }

    .evolution-data {
        width: 100%;
        border-collapse: collapse;
    }

    .evolution-data th {
        background: #667eea;
        color: white;
        padding: 12px;
        text-align: center;
        font-weight: 500;
    }

    .evolution-data td {
        padding: 10px 12px;
        text-align: center;
        border-bottom: 1px solid #dee2e6;
    }

    .evolution-data tr:hover {
        background: #f8f9fa;
    }

    .evolution-notice {
        background: #e7f3ff;
        border: 1px solid #bee5eb;
        border-radius: 8px;
        padding: 15px;
        margin-bottom: 20px;
    }

    .evolution-notice p {
        margin: 0;
        color: #0c5460;
    }

    .global-actions {
        display: flex;
        justify-content: center;
        gap: 20px;
        margin: 30px 0;
        padding: 25px;
        background: #f8f9fa;
        border-radius: 10px;
    }

    .btn-primary.large {
        padding: 15px 30px;
        font-size: 16px;
        font-weight: bold;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border: none;
        border-radius: 8px;
        color: white;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .btn-primary.large:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
    }

    /* Responsividade */
    @media (max-width: 768px) {
        .reports-filters {
            flex-direction: column;
            align-items: stretch;
        }
        
        .filter-group {
            min-width: 100%;
        }
        
        .reports-tabs {
            flex-direction: column;
        }
        
        .report-header {
            flex-direction: column;
            gap: 15px;
            text-align: center;
        }
        
        .chart-container {
            height: 300px;
        }
        
        .mini-stats {
            flex-direction: column;
            gap: 8px;
        }
        
        .global-actions {
            flex-direction: column;
        }
    }

    /* Animações */
    @keyframes slideIn {
        from {
            transform: translateX(100%);
            opacity: 0;
        }
        to {
            transform: translateX(0);
            opacity: 1;
        }
    }

    @keyframes slideOut {
        from {
            transform: translateX(0);
            opacity: 1;
        }
        to {
            transform: translateX(100%);
            opacity: 0;
        }
    }

    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
    }

    .report-tab.active {
        animation: fadeIn 0.4s ease-out;
    }
</style>

<!-- JavaScript para controlar as abas -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Controle das abas de relatórios
    const tabBtns = document.querySelectorAll('.tab-btn');
    const reportTabs = document.querySelectorAll('.report-tab');
    
    tabBtns.forEach(btn => {
        btn.addEventListener('click', () => {
            // Remover active de todos
            tabBtns.forEach(b => b.classList.remove('active'));
            reportTabs.forEach(t => t.classList.remove('active'));
            
            // Ativar selecionado
            btn.classList.add('active');
            const tabId = btn.dataset.tab + '-tab';
            document.getElementById(tabId).classList.add('active');
        });
    });
    
    // Filtros
    const clearFiltersBtn = document.getElementById('clear-filters');
    if (clearFiltersBtn) {
        clearFiltersBtn.addEventListener('click', () => {
            document.getElementById('report-patient-select').value = '';
            document.getElementById('report-date-from').value = '';
            document.getElementById('report-date-to').value = '';
            
            if (window.reportsManager) {
                window.reportsManager.selectedPatient = null;
                window.reportsManager.selectedDateRange = null;
                window.reportsManager.updateReports();
            }
        });
    }
    
    const applyFiltersBtn = document.getElementById('apply-filters');
    if (applyFiltersBtn) {
        applyFiltersBtn.addEventListener('click', () => {
            if (window.reportsManager) {
                window.reportsManager.updateReports();
            }
        });
    }
    
    // Refresh reports
    const refreshBtn = document.getElementById('refresh-reports');
    if (refreshBtn) {
        refreshBtn.addEventListener('click', () => {
            if (window.reportsManager && window.terapeutaPanel) {
                window.terapeutaPanel.refreshData().then(() => {
                    const evaluations = window.terapeutaPanel.filteredEvaluations;
                    window.reportsManager.setData(evaluations);
                });
            }
        });
    }
});
</script>